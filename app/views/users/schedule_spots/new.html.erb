<turbo-frame id="add_new_schedule_spot">
  <!-- モーダルのラッパー -->
  <div role="dialog" tabindex="-1" class="fixed inset-0 z-60 flex items-center justify-center w-full h-screen p-2">
    <!-- 背景 -->
    <div data-action="click->modal#close" class="fixed inset-0 block w-full h-screen cursor-default bg-gray-900/30"></div>
    <div class="relative z-20 w-full max-w-2xl h-[80vh] bg-bg rounded-md flex flex-col">
      <main class="flex flex-col items-center px-8 py-6 flex-1 overflow-hidden">
        <h1 class="text-2xl text-primary font-bold mb-8">しおりを選択</h1>

        <%# 追加するスポット情報 %>
        <div class="w-full max-w-2xl mb-8">
          <div class="bg-gray-100 rounded-lg p-4">
            <p class="text-sm text-gray-600 mb-2">追加するスポット</p>
             <% if @spot_ids.present? %>
              <!-- 複数スポット -->
              <p class="text-sm font-bold"><%= @spots.size %>件のスポットを追加します</p>
              <div class="mt-2 max-h-24 overflow-y-auto">
                <% @spots.each do |spot| %>
                  <p class="text-sm text-gray-700">• <%= spot.name %></p>
                <% end %>
              </div>
            <% else %>
              <!-- 単一スポット -->
              <h2 class="text-xl font-bold text-primary"><%= @spot.name %></h2>
              <p class="text-sm text-gray-500"><%= @spot.category&.name %></p>
            <% end %>
          </div>
        </div>

        <%# しおり一覧 %>
        <div class="w-full max-w-2xl flex-1 overflow-y-auto">
          <% if @schedules.any? %>
            <div class="space-y-4">
              <% @schedules.each do |schedule| %>
                <div class="bg-white rounded-lg shadow p-6">
                  <h3 class="text-xl font-bold mb-2"><%= schedule.name %></h3>
                  <% if schedule.start_date.present? && schedule.end_date.present? %>
                    <p class="text-gray-600 mb-3">
                      <%= schedule.start_date %> ~ <%= schedule.end_date %>
                    </p>
                  <% end %>
                  <% if @spot_ids.present? %>
                    <!-- 複数スポット用フォーム -->
                    <%= form_with url: card_spots_schedule_spots_path(@card, schedule_id: schedule.id), method: :post do |f| %>
                      <% @spot_ids.each do |spot_id| %>
                        <%= f.hidden_field :spot_ids, multiple: true, value: spot_id %>
                      <% end %>
                      <%= f.submit "このしおりに追加", class: "btn-main w-full" %>
                    <% end %>
                  <% else %>
                    <!-- 単一スポット用ボタン -->
                    <%= button_to "このしおりに追加",
                        card_spot_schedule_spots_path(@card, @spot, schedule_id: schedule.id),
                        method: :post,
                        class: "btn-main w-full" %>
                    <% end %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center">まだしおりがありません</p>
          <% end %>
        </div>

        <%# 戻る %>
        <div class="w-full max-w-2xl mt-6">
          <% if @spot_ids.present? %>
            <%= link_to "戻る", card_path(@card), class: "btn-sub w-full block text-center" %>
          <% else %>
            <%= link_to "戻る", card_spot_path(@card, @spot), class: "btn-sub w-full block text-center" %>
          <% end %>
        </div>
      </main>
    </div>
  </div>
</turbo-frame>
