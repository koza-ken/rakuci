<% content_for(:title, t('expenses.edit_expense')) %>
<% breadcrumb :group_expenses, @group %>

<main id="main" class="flex flex-col items-center justify-center px-8 py-6 mb-12">
  <div class="w-full max-w-2xl">
    <%# ページタイトル %>
    <h1 class="text-xl font-bold text-text mb-6"><%= t('expenses.edit_expense') %></h1>

    <%# 支払いを編集する %>
    <%# TODO 支出の追加と編集ページのレイアウトが一緒 %>
    <div class="mb-8 p-6 pb-10 bg-white rounded border border-gray-200">
      <%= form_with model: [@group, @expense], local: true, data: { turbo: false }, class: "space-y-4" do |f| %>
        <%# 支払った人 %>
        <div>
          <div class="flex items-center justify-start gap-2 mb-2">
            <%= f.label :paid_by_membership_id, t('expenses.paid_by'), class: "text-sm font-semibold text-text" %>
            <% if @expense.errors[:paid_by_membership].any? %>
              <p class="text-red-600 text-xs">※<%= @expense.errors.full_messages_for(:paid_by_membership).first %></p>
            <% end %>
          </div>
          <%= f.collection_select :paid_by_membership_id,
              @group.group_memberships,
              :id,
              :nickname,
              { prompt: t('expenses.select_payer') },
              { class: "form-text-field w-full" } %>
        </div>

        <%# 対象者チェックボックス %>
        <div>
          <div class="flex items-center justify-start gap-2 mb-2">
            <p class="text-sm font-semibold text-text"><%= t('expenses.participants') %></p>
            <% if @expense.errors[:base].any? %>
              <p class="text-red-600 text-xs">※<%= @expense.errors[:base].first %></p>
            <% end %>
          </div>
          <div class="space-y-2">
            <% @group.group_memberships.each do |membership| %>
              <label class="flex items-center gap-2">
                <%= check_box_tag "expense[participant_ids][]", membership.id, @expense.participants.map(&:id).include?(membership.id), { class: "form-checkbox" } %>
                <span class="text-text"><%= membership.nickname %></span>
              </label>
            <% end %>
          </div>
        </div>

        <%# 説明 %>
        <div>
          <div class="flex items-center justify-start gap-2 mb-2">
            <%= f.label :name, t('expenses.description'), class: "text-sm font-semibold text-text" %>
            <% if @expense.errors[:name].any? %>
              <p class="text-red-600 text-xs">※<%= @expense.errors.full_messages_for(:name).first %></p>
            <% end %>
          </div>
          <%= f.text_field :name, placeholder: t('expenses.name_placeholder'), class: "form-text-field w-full" %>
        </div>

        <%# 金額 %>
        <div>
          <div class="flex items-center justify-start gap-2 mb-2">
            <%= f.label :amount, t('expenses.amount'), class: "text-sm font-semibold text-text" %>
            <% if @expense.errors[:amount].any? %>
              <p class="text-red-600 text-xs">※<%= @expense.errors.full_messages_for(:amount).first %></p>
            <% end %>
          </div>
          <div class="flex items-center gap-2">
            <%= f.number_field :amount, placeholder: "0", min: "1", class: "form-text-field flex-1 [&::-webkit-outer-spin-button]:hidden [&::-webkit-inner-spin-button]:hidden" %>
            <span class="text-text">円</span>
          </div>
        </div>

        <%# 支払日 %>
        <div>
          <div class="flex items-center justify-start gap-2 mb-2">
            <%= f.label :paid_at, t('expenses.paid_at'), class: "text-sm font-semibold text-text" %>
            <% if @expense.errors[:paid_at].any? %>
              <p class="text-red-600 text-xs">※<%= @expense.errors.full_messages_for(:paid_at).first %></p>
            <% end %>
          </div>
          <%= f.date_field :paid_at, value: @expense.paid_at || Date.current, class: "form-text-field w-full" %>
        </div>

        <%# ボタン %>
        <div class="flex gap-2 mt-6">
          <%= f.submit t('expenses.update_button'), class: "btn-main flex-1" %>
          <%= link_to t('expenses.back_to_expenses'), group_expenses_path(@group), class: "btn-sub flex-1 text-center" %>
        </div>
      <% end %>
      </div>
    </div>
  </div>
</main>
