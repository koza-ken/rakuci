<%= turbo_frame_tag "spot-create-modal", data: { controller: "modal" } %>
<%= turbo_frame_tag "add_new_schedule_spot" %>

<div class="relative z-20 w-full max-w-2xl max-h-screen overflow-y-auto bg-bg rounded-md">
  <main class="flex flex-col px-8 py-12 bg-main-bg">
    <!-- カード名と編集アイコン -->
    <div class="flex items-start gap-6 mb-8">
      <h1 class="text-2xl font-bold text-primary"><%= @card.name %></h1>
      <!-- 編集アイコン（サイズ固定） -->
      <button class="shrink-0 text-primary hover:opacity-70 transition pt-1">
        <%= render "shared/icon/form_icon_edit" %>
      </button>
    </div>

    <!-- スポット追加ボタン -->
    <div class="mb-4" data-controller="modal">
      <%= link_to new_card_spot_path(@card), data: {turbo_frame: "spot-create-modal", action: "click->modal#setGroupId"}, class: "btn-main text-sm px-4 py-2 w-auto" do %>
        スポット追加
      <% end %>
    </div>
    <div class="mb-4">
      <% if !@card.group_card? %>
        <!-- 個人カード: チェックボックスフォーム -->
        <%= form_with url: card_new_schedule_spots_path(@card), method: :get, data: { turbo_frame: "add_new_schedule_spot" } do |f| %>
          <%= render "spots/spots", spots: @card.spots, categories: @categories %>
          <div class="flex gap-2 mt-4">
            <%= f.submit "選択したスポットをしおりに追加", class: "btn-main flex-1" %>
          </div>
        <% end %>
      <% else %>
        <!-- グループカード: チェックボックスフォーム -->
        <%= form_with url: card_spots_group_schedule_spots_path(@card), method: :post, local: true do |f| %>
          <%= render "spots/spots", spots: @card.spots, categories: @categories %>
          <div class="flex gap-2 mt-4">
            <%= f.submit "選択したスポットをグループのしおりに追加", class: "btn-main flex-1" %>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- コメント欄（グループカードのみ） -->
    <% if @card.group_card? %>
      <div class="mb-6">
        <h2 class="text-xl font-bold text-primary mb-4">コメント</h2>
        <!-- コメント一覧 -->
        <div id="comments_list">
          <% if @comments.present? %>
            <div class="space-y-3 mb-4">
              <% @comments.each do |comment| %>
                <%= render "comments/comment", comment: comment %>
              <% end %>
            </div>
          <% else %>
            <p class="text-gray-500 text-sm mb-4">まだコメントがありません</p>
          <% end %>
        </div>
        <!-- 新規コメント投稿フォーム -->
        <div id="comment_form">
          <%= render "comments/form", card: @card, comment: Comment.new %>
        </div>
      </div>
    <% end %>

    <div class="">
      <%= form_with model: @card, class: "w-full max-w-md" do |f| %>
        <%= f.label :memo, "メモ", class: "block text-2xl font-bold text-primary mb-2" %>
        <%= f.text_area :memo, disabled: true, class: "form-text-field bg-gray-100" %>
      <% end %>
    </div>
  </main>
</div>
