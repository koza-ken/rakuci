<!-- フラッシュメッセージを表示 -->
<%= turbo_stream.update "flash-container", partial: "shared/flash_messages", locals: { flash: flash } %>

<!-- カード名セクション全体を置き換える -->
<!-- バリデーション失敗時は form-hidden クラスなし（表示状態）、成功時は class="hidden"（非表示） -->
<%= turbo_stream.replace "card-name-section" do %>
  <div id="card-name-section" data-controller="card-edit">
    <!-- 表示モード：エラーがあれば非表示 -->
    <div id="card-name-display" class="<%= 'hidden' if @card.errors.any? %> flex items-start gap-6 mb-4" data-card-edit-target="display">
      <h1 class="text-2xl font-bold text-text"><%= @card.name %></h1>
      <!-- 編集アイコン（サイズ固定） -->
      <button class="shrink-0 text-text hover:opacity-70 transition pt-1" data-action="click->card-edit#toggleForm">
        <%= render "shared/icon/form_icon_edit" %>
      </button>
    </div>

    <!-- 編集モード：エラーがなければ hidden、あればを表示 -->
    <div id="card-name-form" class="<%= 'hidden' unless @card.errors.any? %> mb-4" data-card-edit-target="form">
      <%= form_with model: @card, local: true do |f| %>
        <div class="flex items-center gap-2">
          <%= f.text_field :name, class: "form-text-field flex-1" %>
          <%= f.submit t('cards.form.update'), class: "btn-main px-4 py-2 w-auto" %>
          <button type="button" class="btn-sub w-auto px-2 py-1" data-action="click->card-edit#toggleForm">
            <p class="text-2xl">×</p>
          </button>
        </div>
        <!-- エラーメッセージ表示 -->
        <% if @card.errors.any? %>
          <div class="mt-2">
            <% @card.errors.messages[:name].each do |message| %>
              <p class="text-red-600 text-sm"><%= message %></p>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<!-- メモセクション全体を置き換える -->
<%= turbo_stream.replace "memo-section" do %>
  <div id="memo-section" class="w-full max-w-md" data-controller="memo-edit">
    <!-- 表示モード：エラーがあれば非表示 -->
    <div id="memo-display" data-memo-edit-target="display" class="<%= 'hidden' if @card.errors.any? %> cursor-pointer">
      <%= form_with model: @card, class: "w-full" do |f| %>
        <%= f.label :memo, t('cards.form.memo'), class: "block text-2xl font-bold text-text mb-2" %>
        <%= f.text_area :memo, class: "form-text-field bg-gray-100 cursor-pointer", readonly: true, data: { action: "click->memo-edit#toggleForm" } %>
      <% end %>
    </div>

    <!-- 編集モード：エラーがなければ hidden、あればを表示 -->
    <div id="memo-form" data-memo-edit-target="form" class="<%= 'hidden' unless @card.errors.any? %> w-full">
      <%= form_with model: @card, local: true, class: "w-full" do |f| %>
        <%= f.label :memo, t('cards.form.memo'), class: "block text-2xl font-bold text-text mb-2" %>
        <%= f.text_area :memo, class: "form-text-field flex-1 resize-none min-h-[100px]", placeholder: "メモを入力してください" %>
        <div class="flex gap-2 mt-2">
          <%= f.submit t('cards.form.update'), class: "btn-main px-4 py-2 w-auto" %>
          <button type="button" class="btn-sub px-4 py-2 w-auto" data-action="click->memo-edit#toggleForm">
            <%= t('cards.form.cancel') %>
          </button>
        </div>
        <!-- エラーメッセージ表示 -->
        <% if @card.errors.any? %>
          <div class="mt-2">
            <% @card.errors.messages[:memo].each do |message| %>
              <p class="text-red-600 text-sm"><%= message %></p>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
